# Default Configurations for AzureDefender-K8S-InClusterDefense.
# This is a ConfigMap file.
# Declare variables to be passed into configurations object of the project's files.
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{.Values.AzDProxy.prefixResourceDeployment}}-config
  namespace: '{{ .Release.Namespace }}'
  labels:
  {{ include "common.labels" . | indent 6 }}
# Application's configuration settings. Arranged by project's filesystem hierarchy
data:
  appConfig.yaml: |-
    webhook:
      certRotatorConfiguration:
        secretName: "{{ .Values.AzDProxy.prefixResourceDeployment }}-{{.Values.AzDProxy.webhook.CertRotatorConfiguration.SecretName }}"
        serviceName: "{{ .Values.AzDProxy.prefixResourceDeployment }}-{{.Values.AzDProxy.webhook.CertRotatorConfiguration.ServiceName }}"
        webhookName: "{{ .Values.AzDProxy.prefixResourceDeployment }}-{{.Values.AzDProxy.webhook.CertRotatorConfiguration.WebhookName }}"
        caName: "{{ .Values.AzDProxy.prefixResourceDeployment }}-{{.Values.AzDProxy.webhook.CertRotatorConfiguration.CaName }}"
        caOrganization: "{{ .Values.AzDProxy.prefixResourceDeployment }}"
        certDir: {{.Values.AzDProxy.webhook.volume.mountPath | quote}}
        namespace: {{.Release.Namespace | quote}}
      managerConfiguration:
        port: {{.Values.AzDProxy.service.targetPort}}
        certDir: {{.Values.AzDProxy.webhook.volume.mountPath | quote}}
      serverConfiguration:
        path: {{.Values.AzDProxy.webhook.mutationPath | quote}}
        enableCertRotation: {{.Values.AzDProxy.webhook.ServerConfiguration.EnableCertRotation}}
      handlerConfiguration:
        dryRun: {{.Values.AzDProxy.webhook.HandlerConfiguration.RunOnDryRunMode}}
    instrumentation:
      trace:
        tracerConfiguration:
          tracerLevel: {{.Values.AzDProxy.instrumentation.trace.TracerConfiguration.TracerLevel }}
      tivan:
        tivanInstrumentationConfiguration:
          componentName: {{ .Chart.Name | quote}}
          mdmNamespace: {{ .Values.AzDProxy.instrumentation.tivan.TivanInstrumentationConfiguration.MdmNamespace | quote}}
    azdIdentity:
      envAzureAuthorizerConfiguration:
        isLocalDevelopmentMode: {{.Values.AzDProxy.azureauth.envAzureAuthorizerConfiguration.IsLocalDevelopmentMode}}
        mSIClientId: {{.Values.AzDProxy.azureauth.envAzureAuthorizerConfiguration.MSIClientId}}
    kubeletIdentity:
      envAzureAuthorizerConfiguration:
        isLocalDevelopmentMode: {{.Values.AzDProxy.Deployment.IsLocalDevelopment}}
        mSIClientId: {{.Values.AzDProxy.kubeletIdentity.EnvAzureAuthorizerConfiguration.MSIClientId}}
    acr:
      craneWrappersConfiguration:
          retryAttempts: {{ .Values.AzDProxy.wrappers.craneWrappers.RetryPolicyConfiguration.retryCount }}
          retryDuration: {{ .Values.AzDProxy.wrappers.craneWrappers.RetryPolicyConfiguration.SleepDurationBetweenRetries }}
    arg:
      argBaseClient:
        retryPolicyConfiguration:
          retryAttempts: {{ .Values.AzDProxy.retryPolicy.retryPolicyConfiguration.retryCount }}
          retryDuration: {{ .Values.AzDProxy. }}

